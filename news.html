<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News & Updates | MET'S IEDC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: { fontFamily: { sans: ['Inter', 'sans-serif'] } }
            }
        }
    </script>

    <style>
        body { background-color: #050505; color: #ffffff; overflow-x: hidden; }
        .glass-nav { background: rgba(5, 5, 5, 0.8); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; }
        .glass-card:hover { transform: translateY(-5px); border-color: rgba(255, 255, 255, 0.2); box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .blob { position: absolute; border-radius: 50%; filter: blur(80px); z-index: -1; opacity: 0.3; }
        .blob-1 { top: 0; left: 0; width: 500px; height: 500px; background: #4f46e5; }
        .blob-2 { bottom: 0; right: 0; width: 500px; height: 500px; background: #9333ea; }
        
        /* Tabs */
        .tab-btn { padding: 10px 24px; border-radius: 99px; font-size: 14px; font-weight: 600; transition: all 0.3s; border: 1px solid transparent; color: #9ca3af; }
        .tab-btn.active { background: white; color: black; border-color: white; }
        .tab-btn:hover:not(.active) { color: white; background: rgba(255,255,255,0.1); }
    </style>
</head>
<body class="font-sans antialiased relative selection:bg-indigo-500 selection:text-white">

    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <nav class="glass-nav fixed top-0 w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <img src="assets/images/logos/MSEM.jpg" alt="Logo" class="h-10 w-10 rounded-full border border-white/20">
                <span class="text-xl font-bold tracking-tight text-white">MET'S <span class="text-indigo-400">IEDC</span></span>
            </div>
            <div class="hidden md:flex space-x-8">
                <a href="index.html" class="text-gray-300 hover:text-white text-sm font-medium transition-colors">Home</a>
                <a href="announcement.html" class="text-white text-sm font-bold border-b-2 border-indigo-500">News & Updates</a>
                <a href="login.html" class="px-5 py-2 rounded-full bg-white/10 hover:bg-white/20 text-sm font-bold transition">Login</a>
            </div>
        </div>
    </nav>

    <div class="pt-32 pb-12 text-center px-4 relative z-10">
        <h1 class="text-5xl md:text-6xl font-bold tracking-tight mb-4">Newsroom</h1>
        <p class="text-gray-400 max-w-xl mx-auto">Stay updated with the latest events, achievements, and circulars from MET'S IEDC.</p>
        
        <div class="flex justify-center gap-4 mt-10">
            <button onclick="filterContent('all')" class="tab-btn active" id="btn-all">All Posts</button>
            <button onclick="filterContent('news')" class="tab-btn" id="btn-news">Gallery & News</button>
            <button onclick="filterContent('update')" class="tab-btn" id="btn-update">Circulars</button>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-32 relative z-10">
        <div id="loader" class="text-center py-20">
            <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mx-auto"></div>
            <p class="text-gray-500 mt-4">Fetching updates...</p>
        </div>

        <div id="contentGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 hidden">
            </div>
        
        <div id="emptyState" class="hidden text-center py-20">
            <i data-lucide="inbox" class="w-16 h-16 text-gray-600 mx-auto mb-4"></i>
            <p class="text-gray-500">No posts found in this category.</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        lucide.createIcons();

        // --- PASTE YOUR FIREBASE CONFIG HERE ---
        const firebaseConfig = {
            apiKey: "AIzaSyAIn9hB7Hx4Nwwk5Ar9bE3tFuo40VkBcc8",
            authDomain: "metsiedc-3010e.firebaseapp.com",
            databaseURL: "https://metsiedc-3010e-default-rtdb.firebaseio.com",
            projectId: "metsiedc-3010e",
            storageBucket: "metsiedc-3010e.firebasestorage.app",
            messagingSenderId: "954403413150",
            appId: "1:954403413150:web:2523a3377f15a3d6002f8f",
            measurementId: "G-6E7EK0D7JG"
        };
        // ---------------------------------------

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let allPosts = [];

        // Fetch Data
        async function fetchPosts() {
            try {
                // Fetch all announcements sorted by newest
                const q = query(collection(db, "announcements"), orderBy("timestamp", "desc"));
                const snap = await getDocs(q);
                
                allPosts = [];
                snap.forEach(doc => {
                    allPosts.push({ id: doc.id, ...doc.data() });
                });

                document.getElementById('loader').classList.add('hidden');
                document.getElementById('contentGrid').classList.remove('hidden');
                renderPosts('all');

            } catch (error) {
                console.error("Error:", error);
                document.getElementById('loader').innerHTML = `<p class="text-red-400">Failed to load content.</p>`;
            }
        }

        // Render Function
        window.renderPosts = (filter) => {
            const grid = document.getElementById('contentGrid');
            const empty = document.getElementById('emptyState');
            grid.innerHTML = '';

            const filtered = filter === 'all' ? allPosts : allPosts.filter(p => p.type === filter || (filter === 'update' && !p.type)); // Handle legacy posts as updates

            if (filtered.length === 0) {
                grid.classList.add('hidden');
                empty.classList.remove('hidden');
                return;
            }

            grid.classList.remove('hidden');
            empty.classList.add('hidden');

            filtered.forEach(post => {
                let cardHtml = '';
                const date = post.date || new Date(post.timestamp).toLocaleDateString();

                if (post.type === 'news') {
                    // --- NEWS CARD (Image Focus) ---
                    cardHtml = `
                        <div class="glass-card rounded-2xl overflow-hidden flex flex-col h-full group">
                            <div class="h-48 overflow-hidden relative">
                                <img src="${post.fileUrl || 'assets/images/placeholder.jpg'}" alt="${post.title}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                                <div class="absolute top-3 left-3 bg-blue-600 text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">News</div>
                            </div>
                            <div class="p-6 flex-grow flex flex-col">
                                <div class="text-xs text-gray-400 mb-2 flex items-center gap-2">
                                    <i data-lucide="calendar" class="w-3 h-3"></i> ${date}
                                </div>
                                <h3 class="text-lg font-bold text-white mb-3 leading-snug group-hover:text-blue-400 transition-colors">${post.title}</h3>
                                <p class="text-sm text-gray-400 line-clamp-3 mb-4 flex-grow">${post.description}</p>
                                <button onclick="openImageModal('${post.fileUrl}')" class="text-xs font-bold text-white bg-white/10 hover:bg-white/20 py-2 rounded-lg transition text-center w-full">View Image</button>
                            </div>
                        </div>
                    `;
                } else {
                    // --- UPDATE CARD (Circular/Notice Focus) ---
                    const linkBtn = post.fileUrl ? `<a href="${post.fileUrl}" target="_blank" class="mt-4 flex items-center justify-center gap-2 w-full bg-red-600/10 hover:bg-red-600/20 text-red-400 border border-red-600/20 font-bold py-2 rounded-lg text-xs transition"><i data-lucide="download" class="w-3 h-3"></i> Download / View</a>` : '';
                    
                    cardHtml = `
                        <div class="glass-card rounded-2xl p-6 flex flex-col h-full border-l-4 border-red-500">
                            <div class="flex justify-between items-start mb-4">
                                <span class="text-[10px] font-bold text-red-400 bg-red-400/10 px-2 py-1 rounded uppercase tracking-wider">${post.category || 'Update'}</span>
                                <span class="text-xs text-gray-500">${date}</span>
                            </div>
                            <h3 class="text-lg font-bold text-white mb-2">${post.title}</h3>
                            <p class="text-sm text-gray-400 leading-relaxed flex-grow">${post.description}</p>
                            ${linkBtn}
                        </div>
                    `;
                }
                grid.innerHTML += cardHtml;
            });
            lucide.createIcons();
        };

        // Filter Logic
        window.filterContent = (type) => {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${type}`).classList.add('active');
            renderPosts(type);
        };

        // Simple Image Modal
        window.openImageModal = (url) => {
            if(!url) return;
            const w = window.open("", "_blank");
            w.document.write(`<body style="margin:0;display:flex;align-items:center;justify-content:center;background:black;height:100vh;"><img src="${url}" style="max-width:100%;max-height:100vh;object-fit:contain;"></body>`);
        };

        fetchPosts();
    </script>
</body>
</html>
