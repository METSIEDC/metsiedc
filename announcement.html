<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Announcements - MET'S IEDC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Lucide Icons for a clean, modern look -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* NEW Color Palette based on provided image */
        :root {
            --color-light-background: #F8F8FA; /* Very light background for body */
            --color-card-background: #FFFFFF; /* Pure white for main content areas */
            --color-dark-text: #333333; /* Dark gray for headings and main text */
            --color-muted-text: #7A7A80; /* Muted gray for secondary text/labels */
            --color-primary-blue: #00BFFF; /* Vibrant Sky Blue - Main accent color from image */
            --color-primary-blue-light: #E0F7FA; /* Very light blue for subtle accents/backgrounds */
            --color-primary-blue-dark: #008DCC; /* Darker blue for hover */
            --color-border-light: #E0E0E0; /* Light gray for subtle borders */
            --color-border-subtle-dark: #D4D4D8; /* Slightly darker light border */
            --color-shadow-light: rgba(0, 0, 0, 0.05); /* Light shadow for cards */
            --color-shadow-medium: rgba(0, 0, 0, 0.1); /* Medium shadow for hover/header */
            --color-placeholder-text: #B0B0B0; /* Placeholder text color */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-light-background);
            color: var(--color-dark-text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Utility classes using custom colors */
        .text-primary-blue { color: var(--color-primary-blue); }
        .bg-primary-blue { background-color: var(--color-primary-blue); }
        .hover\:bg-primary-blue-dark:hover { background-color: var(--color-primary-blue-dark); }
        .text-dark-heading { color: var(--color-dark-text); }
        .text-muted { color: var(--color-muted-text); }
        .bg-card-background { background-color: var(--color-card-background); }
        .bg-page-background { background-color: var(--color-light-background); }

        /* General Container and Spacing */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        /* Header Specific Styles */
        header {
            background-color: var(--color-card-background);
            box-shadow: 0 2px 8px var(--color-shadow-light);
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .header-link {
            color: var(--color-muted-text);
            font-weight: 500;
            transition: color 0.2s ease;
        }
        .header-link:hover {
            color: var(--color-dark-text);
        }
        .header-accent-link {
             color: var(--color-primary-blue);
             font-weight: 600;
        }
        .header-border {
            border-left: 1px solid var(--color-border-light);
            padding-left: 1rem;
            margin-left: 1rem;
        }

        /* Announcements Hero Section */
        .hero-section {
            background-color: var(--color-card-background);
            padding: 4rem 0; /* More vertical padding */
            border-bottom: 1px solid var(--color-border-light);
            position: relative; /* For the background shapes */
            overflow: hidden;
        }
        .hero-section::before,
        .hero-section::after {
            content: '';
            position: absolute;
            background-color: var(--color-primary-blue-light);
            border-radius: 50%;
            opacity: 0.7;
            pointer-events: none;
            z-index: 0;
        }
        .hero-section::before {
            width: 250px;
            height: 250px;
            top: -100px;
            left: -100px;
        }
        .hero-section::after {
            width: 300px;
            height: 300px;
            bottom: -150px;
            right: -150px;
        }
        .hero-content {
            position: relative; /* Bring content above pseudo-elements */
            z-index: 1;
        }
        .megaphone-icon {
            color: var(--color-primary-blue);
            width: 80px;
            height: 80px;
        }
        .search-input {
            border: 1px solid var(--color-border-subtle-dark);
            border-radius: 0.5rem;
            padding: 0.8rem 1rem;
            color: var(--color-dark-text);
            transition: all 0.2s ease-in-out;
            font-size: 1rem;
        }
        .search-input::placeholder {
            color: var(--color-placeholder-text);
        }
        .search-input:focus {
            border-color: var(--color-primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 191, 255, 0.2); /* Blue focus ring */
            outline: none;
        }

        /* Tabs Navigation */
        .tabs-nav {
            background-color: var(--color-card-background);
            border-bottom: 1px solid var(--color-border-light);
            padding-top: 1rem; /* Space from search bar */
            padding-left: 1.5rem; /* Match container padding */
            padding-right: 1.5rem;
        }
        .tabs-nav .container {
            border-bottom: 2px solid transparent; /* This creates the underline for tabs */
        }
        .tab-button {
            padding: 0.75rem 0; /* Adjust padding */
            font-weight: 500;
            color: var(--color-muted-text);
            border-bottom: 3px solid transparent; /* Individual tab underline */
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            margin-right: 1.5rem; /* Space between tab buttons */
        }
        .tab-button:last-child {
            margin-right: 0;
        }
        .tab-button.active {
            color: var(--color-primary-blue);
            font-weight: 600;
            border-bottom-color: var(--color-primary-blue);
        }
        .tab-button:hover:not(.active) {
            color: var(--color-dark-text);
        }

        /* Announcement List Section */
        .announcement-list-container {
            padding: 3rem 0; /* Vertical padding */
        }
        .announcement-item {
            display: flex;
            background-color: var(--color-card-background);
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px var(--color-shadow-light);
            padding: 1.5rem 2rem;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .announcement-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px var(--color-shadow-medium);
        }
        .announcement-date-col {
            flex-shrink: 0;
            width: 100px; /* Fixed width for date column */
            text-align: right;
            padding-right: 1.5rem;
            border-right: 1px solid var(--color-border-light);
        }
        .announcement-date-col .month-day {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--color-dark-text);
        }
        .announcement-date-col .year {
            font-size: 0.9rem;
            color: var(--color-muted-text);
        }
        .announcement-content-col {
            flex-grow: 1;
            padding-left: 1.5rem;
        }
        .announcement-content-col h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-dark-text);
            margin-bottom: 0.5rem;
        }
        .announcement-content-col p {
            font-size: 0.95rem;
            color: var(--color-muted-text);
        }
        .download-link {
            display: inline-flex;
            align-items: center;
            color: var(--color-primary-blue);
            font-weight: 500;
            margin-top: 0.5rem;
            transition: color 0.2s ease;
        }
        .download-link:hover {
            color: var(--color-primary-blue-dark);
        }

        /* Footer */
        footer {
            background-color: var(--color-card-background); /* Footer matches card background */
            border-top: 1px solid var(--color-border-light);
            color: var(--color-muted-text);
            padding: 2.5rem 0;
            text-align: center;
        }

        /* Loading spinner for announcements */
        .loading-spinner-announcements {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--color-primary-blue);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Adjustments */
        @media (max-width: 767px) {
            .hero-section {
                padding: 2.5rem 0;
            }
            .hero-section::before,
            .hero-section::after {
                display: none; /* Hide complex shapes on mobile */
            }
            .megaphone-icon {
                width: 60px;
                height: 60px;
            }
            .hero-section h1 {
                font-size: 2.5rem;
                margin-top: 1rem;
            }
            .hero-section p {
                font-size: 1rem;
            }
            .search-input {
                padding: 0.7rem 0.8rem;
                font-size: 0.9rem;
            }
            .tabs-nav {
                padding-top: 0.5rem;
                padding-left: 1rem;
                padding-right: 1rem;
            }
            .tabs-nav > div {
                justify-content: space-around; /* Distribute tabs evenly */
            }
            .tab-button {
                font-size: 0.9rem;
                padding: 0.6rem 0.5rem;
                margin-right: 0.5rem; /* Reduced space between tab buttons */
            }
            .announcement-list-container {
                padding: 2rem 0;
            }
            .announcement-item {
                flex-direction: column; /* Stack date and content on mobile */
                padding: 1rem 1.25rem;
                gap: 0.75rem;
            }
            .announcement-date-col {
                width: 100%;
                text-align: left;
                padding-right: 0;
                border-right: none;
                border-bottom: 1px dashed var(--color-border-light); /* Dashed separator */
                padding-bottom: 0.5rem;
            }
            .announcement-content-col {
                padding-left: 0;
            }
            .announcement-content-col h3 {
                font-size: 1rem;
            }
            .announcement-content-col p {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body class="bg-page-background">

    <header>
        <div class="container flex items-center justify-between h-16 sm:h-20">
            <a href="index.html" class="flex items-center space-x-2">
                <img src="https://innovate.startupmission.in/wp-content/uploads/2023/10/iedc_logo.png" alt="IEDC Logo" class="h-8 w-8 sm:h-10 sm:w-10 rounded-full shadow-sm">
                <span class="text-xl sm:text-2xl font-extrabold text-dark-heading">MET'S IEDC</span>
            </a>

            <div class="flex items-center space-x-4">
                <nav class="hidden md:flex items-center space-x-4">
                    <a href="#" class="header-link">Help center</a>
                    <a href="#" class="header-link flex items-center">
                        Products <i data-lucide="chevron-down" class="w-4 h-4 ml-1"></i>
                    </a>
                </nav>

                <div class="hidden sm:flex items-center header-border">
                    <a href="index.html" class="header-link mr-4">Go back to homepage</a>
                    <a href="#" class="header-link flex items-center">
                        <img src="https://flagcdn.com/w20/in.png" alt="India Flag" class="w-5 h-auto mr-1"> English <i data-lucide="chevron-down" class="w-4 h-4 ml-1"></i>
                    </a>
                </div>

                <!-- Mobile menu button -->
                <button id="mobile-menu-button" class="md:hidden text-dark-heading focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu" class="mobile-menu fixed inset-0 bg-card-background z-40 p-4 md:hidden">
            <div class="flex justify-end">
                <button id="close-mobile-menu" class="text-dark-heading focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <nav class="flex flex-col space-y-4 mt-8">
                <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium text-dark-heading hover:bg-gray-100">Home</a>
                <a href="index.html#about" class="block px-3 py-2 rounded-md text-base font-medium text-dark-heading hover:bg-gray-100">About Us</a>
                <a href="team.html" class="block px-3 py-2 rounded-md text-base font-medium text-dark-heading hover:bg-gray-100">Our Team</a>
                <a href="index.html#events" class="block px-3 py-2 rounded-md text-base font-medium text-dark-heading hover:bg-gray-100">Events</a>
                <a href="index.html#initiatives" class="block px-3 py-2 rounded-md text-base font-medium text-dark-heading hover:bg-gray-100">Initiatives</a>
                <a href="index.html#news" class="block px-3 py-2 rounded-md text-base font-medium text-dark-heading hover:bg-gray-100">News</a>
                <a href="announcement.html" class="block px-3 py-2 rounded-md text-base font-medium text-primary-blue hover:bg-gray-100">Announcements</a>
                <a href="event.html" class="block px-3 py-2 rounded-md text-base font-medium text-dark-heading hover:bg-gray-100">Event Gallery</a>
                <a href="index.html#contact" class="block px-3 py-2 rounded-md text-base font-medium text-dark-heading hover:bg-gray-100">Contact</a>
                <a href="login.html" class="mt-4 block w-full text-center px-4 py-2 bg-primary-blue text-white rounded-lg hover:bg-primary-blue-dark transition duration-300 shadow">Student Login</a>
                <a href="dashboard.html" class="mt-2 block w-full text-center px-4 py-2 bg-muted-text text-white rounded-lg hover:bg-dark-text transition duration-300 shadow">Admin Login</a>
            </nav>
        </div>
    </header>

    <main>
        <!-- Hero Section: Title and Search -->
        <section class="hero-section">
            <div class="container hero-content text-center">
                <div class="flex flex-col items-center mb-6">
                    <i data-lucide="megaphone" class="megaphone-icon mb-4"></i>
                    <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-dark-heading leading-tight mb-4">Announcements</h1>
                    <div class="relative w-full max-w-lg mx-auto">
                        <input type="text" id="searchInput" class="w-full search-input pl-12 pr-4 py-3" placeholder="Search articles">
                        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tabs Navigation -->
        <nav class="tabs-nav sticky top-16 sm:top-20 z-40">
            <div class="container flex space-x-6 sm:space-x-8 lg:space-x-12">
                <button class="tab-button active" onclick="filterAnnouncements('all')">All</button>
                <button class="tab-button" onclick="filterAnnouncements('news')">News</button>
                <button class="tab-button" onclick="filterAnnouncements('activities')">Activities</button>
            </div>
        </nav>

        <!-- Announcement List -->
        <section class="announcement-list-container">
            <div class="container">
                <div id="announcements-list" class="flex flex-col gap-4 items-center justify-center py-10">
                    <div class="loading-spinner-announcements" id="loadingSpinner"></div>
                    <p class="text-center text-muted w-full" id="noAnnouncementsMessage">Initializing app and connecting...</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container text-muted">
            <p>&copy; 2025 IEDC MET'S SCHOOL OF ENGINEERING. All Rights Reserved.</p>
            <p class="mt-2">Innovate. Educate. Empower. Developed by Muhammed Shahil.</p>
        </div>
    </footer>

    <!-- Firebase SDK Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, onSnapshot, orderBy, setDoc, getDocs, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase variables (provided by Canvas environment)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app;
        let db;
        let auth;
        let currentUserId = null; 

        // Initialize Firebase
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            console.log("Firebase app and Firestore initialized successfully.");
        } catch (error) {
            console.error("Error initializing Firebase:", error);
            document.getElementById('noAnnouncementsMessage').textContent = "Error: Firebase initialization failed. Check console for details.";
            document.getElementById('loadingSpinner').classList.add('hidden');
            // Exit early if Firebase failed to initialize
            throw new Error("Firebase initialization failed."); 
        }

        // Dummy Announcements Data to Seed (These will be added only once if the collection is empty)
        const initialAnnouncements = [
            {
                title: "The Official Interview Instructions and Final Shortlist",
                description: "The final shortlist for IEDC METS Core Team interviews is out â€” with names, departments, interview time slots, and Zoom guidelines included. Check the official circular for full details.",
                category: "news",
                date: "Jun 23",
                year: "2025",
                fileUrl: "https://innovate.startupmission.in/wp-content/uploads/2023/10/IEDC_Circulars_2024_07.pdf", // Placeholder URL
                fileName: "_IEDC_METS_2025_07.pdf",
                uploadedBy: "Admin",
                timestamp: Date.now() - (1000 * 60 * 60 * 24 * 5)
            },
            {
                title: "Core Team Recruitment 2025",
                description: "All students who applied for the METS IEDC Core Team are informed that the recruitment process has moved to the next round. The interview will be conducted online on June 25, 2025, from 10:00 AM to 12:30 PM via Google Meet. Please check your registered email for details.",
                category: "news",
                date: "Jun 16",
                year: "2025",
                fileUrl: "https://innovate.startupmission.in/wp-content/uploads/2023/10/IEDC_Circulars_2024_04.pdf", // Placeholder URL
                fileName: "IEDC_METS_2025_04.pdf",
                uploadedBy: "Admin",
                timestamp: Date.now() - (1000 * 60 * 60 * 24 * 12)
            },
            {
                title: "IEDC Member Eligibility Criteria Released",
                description: "All interested students are encouraged to review the updated eligibility criteria for becoming a member of MET'S IEDC. The document outlines participation requirements, preferred skill sets, selection process, and code of conduct for the upcoming academic year.",
                category: "activities",
                date: "May 23",
                year: "2025",
                fileUrl: "https://innovate.startupmission.in/wp-content/uploads/2023/10/IEDC_Circulars_2024_06.pdf", // Placeholder URL
                fileName: "IEDC_Member_Eligibility_Criteria.pdf",
                uploadedBy: "Admin",
                timestamp: Date.now() - (1000 * 60 * 60 * 24 * 35)
            },
            {
                title: "Mandatory Presence and Leave Approval for Execcom Members",
                description: "All Execcom members are hereby reminded that attendance in Execcom meetings is mandatory. While participation in other IEDC events is not compulsory, presence is highly encouraged. Leave requests must be informed in advance and approved by the Nodal Officer. Strict adherence is expected, except in cases of medical emergencies.",
                category: "activities",
                date: "Jun 03",
                year: "2025",
                fileUrl: "https://innovate.startupmission.in/wp-content/uploads/2023/10/IEDC_Circulars_2024_05.pdf", // Placeholder URL
                fileName: "Mandatory_Presence_Leave_Approval.pdf",
                uploadedBy: "Admin",
                timestamp: Date.now() - (1000 * 60 * 60 * 24 * 25)
            },
            {
                title: "Upcoming Workshop: Introduction to IoT",
                description: "A hands-on workshop on the Internet of Things (IoT) will be conducted next month. Learn about sensors, microcontrollers, and cloud integration for smart devices.",
                category: "news",
                date: "Jul 10",
                year: "2025",
                fileUrl: "",
                fileName: "",
                uploadedBy: "Team Lead",
                timestamp: Date.now() + (1000 * 60 * 60 * 24 * 10)
            },
            {
                title: "Annual Tech Fest Dates Announced!",
                description: "Get ready for the biggest tech fest of the year! Dates for our annual innovation and technology festival have been finalized. More details on events and registrations coming soon.",
                category: "news",
                date: "Aug 01",
                year: "2025",
                fileUrl: "",
                fileName: "",
                uploadedBy: "Event Coordinator",
                timestamp: Date.now() + (1000 * 60 * 60 * 24 * 40)
            }
        ];


        // Function to seed initial announcements into Firestore if the collection is empty
        async function seedAnnouncements() {
            if (!db) {
                console.error("Firestore not initialized for seeding. Skipping seedAnnouncements.");
                return;
            }

            const announcementsCollectionRef = collection(db, `artifacts/${appId}/public/data/announcements`);
            
            try {
                const q = query(announcementsCollectionRef);
                const snapshot = await getDocs(q); // Use getDocs for a one-time fetch to check emptiness

                if (snapshot.empty) {
                    console.log("Announcements collection is empty, seeding initial data...");
                    for (const announcement of initialAnnouncements) {
                        // Use timestamp as part of the document ID to ensure uniqueness and orderability
                        await setDoc(doc(announcementsCollectionRef, `announcement_${announcement.timestamp}_${Math.random().toString(36).substring(7)}`), announcement);
                    }
                    console.log("Initial announcements seeded.");
                } else {
                    console.log("Announcements collection already contains data, skipping seeding.");
                }
            } catch (error) {
                console.error("Error during seeding process:", error);
                // Even if seeding fails, we should still try to listen for existing data
            }
        }


        // Authenticate user anonymously
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUserId = user.uid;
                console.log("Authenticated as:", currentUserId);
                // Ensure db is available before trying to seed/listen
                if (db) {
                    await seedAnnouncements(); // Ensure announcements exist first
                    setupAnnouncementsListener(); // Then, set up the real-time listener
                } else {
                     console.error("Firestore DB instance not available after authentication.");
                     noAnnouncementsMessage.textContent = "Error: Database not ready after authentication.";
                     loadingSpinner.classList.add('hidden');
                }
            } else {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Signed in with custom token.");
                    } else {
                        await signInAnonymously(auth);
                        console.log("Signed in anonymously.");
                    }
                } catch (error) {
                    console.error("Error during authentication:", error);
                    noAnnouncementsMessage.textContent = "Error authenticating. Please try again.";
                    loadingSpinner.classList.add('hidden');
                }
            }
        });


        // Global variable to store fetched announcements
        let allAnnouncements = [];
        let currentFilter = 'all'; // Default filter
        const announcementsList = document.getElementById('announcements-list');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const noAnnouncementsMessage = document.getElementById('noAnnouncementsMessage');
        const searchInput = document.getElementById('searchInput');

        // Function to render announcements based on filter and search query
        function renderAnnouncements() {
            loadingSpinner.classList.add('hidden'); // Always hide spinner when render is called
            
            const searchQuery = searchInput.value.toLowerCase();
            const filteredAnnouncements = allAnnouncements.filter(announcement => {
                const matchesCategory = currentFilter === 'all' || announcement.category === currentFilter;
                const matchesSearch = announcement.title.toLowerCase().includes(searchQuery) ||
                                      announcement.description.toLowerCase().includes(searchQuery);
                return matchesCategory && matchesSearch;
            });

            announcementsList.innerHTML = ''; // Clear previous content

            if (filteredAnnouncements.length === 0) {
                noAnnouncementsMessage.textContent = `No announcements found matching your criteria.`;
                noAnnouncementsMessage.classList.remove('hidden');
                return;
            } else {
                noAnnouncementsMessage.classList.add('hidden'); // Hide message if results exist
            }

            filteredAnnouncements.forEach(announcement => {
                const downloadLinkHtml = announcement.fileUrl && announcement.fileName ? `
                    <a href="${announcement.fileUrl}" target="_blank" class="download-link text-primary-blue hover:text-primary-blue-dark">
                        <i data-lucide="download" class="w-4 h-4 mr-1"></i> Download ${announcement.fileName}
                    </a>
                ` : '';

                const itemHtml = `
                    <div class="announcement-item gap-4">
                        <div class="announcement-date-col">
                            <div class="month-day">${announcement.date}</div>
                            <div class="year">${announcement.year}</div>
                        </div>
                        <div class="announcement-content-col">
                            <h3>${announcement.title}</h3>
                            <p>${announcement.description}</p>
                            ${downloadLinkHtml}
                        </div>
                    </div>
                `;
                announcementsList.innerHTML += itemHtml;
            });

            // Re-create Lucide icons for newly added elements
            lucide.createIcons();
        }

        // Function to handle tab clicks
        function filterAnnouncements(category) {
            currentFilter = category;
            document.querySelectorAll('.tab-button').forEach(button => {
                // Use textContent for comparison as it directly reflects the button text
                if (button.textContent.toLowerCase().trim() === category.toLowerCase().trim()) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
            // Clear search input on tab change (common UI pattern)
            searchInput.value = ''; 
            renderAnnouncements(); // Re-render with new filter and cleared search
        }

        // Event listener for search input
        searchInput.addEventListener('input', renderAnnouncements);

        // --- Firebase Firestore Listener for Announcements ---
        function setupAnnouncementsListener() {
            if (!db) {
                console.error("Firestore not initialized for listener. Skipping setupAnnouncementsListener.");
                noAnnouncementsMessage.textContent = "Error: Database not ready.";
                loadingSpinner.classList.add('hidden');
                return;
            }

            loadingSpinner.classList.remove('hidden');
            noAnnouncementsMessage.textContent = 'Loading announcements...';
            noAnnouncementsMessage.classList.remove('hidden');

            const announcementsCollectionRef = collection(db, `artifacts/${appId}/public/data/announcements`);
            // Ordering by timestamp ensures the latest announcements are at the top
            const q = query(announcementsCollectionRef, orderBy('timestamp', 'desc')); 

            onSnapshot(q, (snapshot) => {
                allAnnouncements = [];
                snapshot.forEach((doc) => {
                    allAnnouncements.push(doc.data());
                });
                console.log("Announcements fetched:", allAnnouncements.length, "items."); 
                renderAnnouncements(); // Render announcements after fetching
            }, (error) => {
                console.error("Error fetching announcements:", error);
                noAnnouncementsMessage.textContent = "Error loading announcements. Please try again.";
                loadingSpinner.classList.add('hidden');
            });
        }

        // Initial setup on page load:
        // 1. Initialize Lucide icons for static elements.
        // 2. Set initial loading state.
        // 3. Firebase authentication (onAuthStateChanged) will then handle seeding and listener setup.
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons(); // For static icons in header etc.

            loadingSpinner.classList.remove('hidden');
            noAnnouncementsMessage.textContent = 'Initializing app and connecting to database...';
            noAnnouncementsMessage.classList.remove('hidden');

            // Firebase authentication `onAuthStateChanged` will run automatically
            // after the app initializes and will call `seedAnnouncements` and `setupAnnouncementsListener`
            // once authentication is complete.
        });
    </script>
</body>
</html>
